{"version":3,"sources":["../webpack/bootstrap","../external \"vscode\"",".././src/utils.ts",".././src/extension.ts",".././src/calls/index.ts",".././src/calls/model.ts",".././src/references/index.ts",".././src/references/model.ts",".././src/tree.ts",".././src/highlights.ts",".././src/navigation.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","array","e","idx","indexOf","splice","length","async","uri","position","doc","vscode","workspace","openTextDocument","range","getWordRangeAtPosition","Boolean","beforeLen","trim","previewStart","start","with","character","Math","max","wordRange","before","getText","Range","inside","previewEnd","end","translate","after","replace","commands","executeCommand","this","undefined","_doc","_position","_version","version","_word","_getAnchorWord","pos","wordNow","startLine","line","checked","lineCount","ch","lineAt","text","Position","context","tree","SymbolsTree","references","register","calls","setInput","input","showCallItem","item","preserveFocus","CallItem","selection","selectionRange","removeCallItem","remove","direction","RichCallsDirection","workspaceState","setCallsDirection","anchor","newInput","oldInput","getInput","CallsTreeInput","Location","location","subscriptions","push","registerCommand","window","activeTextEditor","document","active","_mem","_value","_ctxMode","ContextKey","raw","_key","set","update","contextValue","title","items","Promise","resolve","model","CallsModel","provider","CallItemDataProvider","roots","navigation","highlights","dispose","parent","locations","_onDidChange","EventEmitter","onDidChange","event","map","from","fromRanges","to","children","_resolveCalls","find","toString","_move","fwd","tail","includes","filter","loc","siblings","del","fire","_model","_emitter","onDidChangeTreeData","_modelListener","element","TreeItem","description","detail","iconPath","_getThemeIcon","kind","command","arguments","collapsibleState","TreeItemCollapsibleState","Collapsed","getCallChildren","id","_themeIconIds","ThemeIcon","findLocations","ReferencesTreeInput","showReferencesDisposable","args","showReferenceItem","removeReferenceItem","copyCommand","copyAllCommand","copyPathCommand","config","updateShowReferences","affectsConfiguration","getConfiguration","onDidChangeConfiguration","ReferenceItem","file","FileItem","val","ReferencesModel","asCopyText","env","clipboard","writeText","scheme","fsPath","_command","_result","resut","ReferencesTreeDataProvider","message","last","sort","_compareLocations","targetUri","targetRange","_compareUriIgnoreFragment","fragment","a","b","aStr","bStr","aUri","bUri","aRange","bRange","isBefore","isAfter","total","reduce","prev","cur","files","ref","contains","lastBefore","best","bestValue","_prefixLen","charCodeAt","delta","_item","result","_listener","File","getDocument","getPreviewChunks","label","TreeItem2","None","asRelativePath","warmUpNext","_document","next","chunks","viewId","_ctxIsActive","_ctxHasResult","_ctxInputSource","_history","TreeInputHistory","_provider","TreeDataProviderDelegate","_tree","createTreeView","treeDataProvider","showCollapseAll","_navigation","Navigation","_sessionDisposable","_input","isValidRequestPosition","clearInput","newInputKind","getPrototypeOf","modelPromise","then","add","nearest","visible","reveal","select","focus","expand","disposables","EditorHighlights","Disposable","reset","size","_sessionDispoables","catch","err","console","error","_assertProvider","getTreeItem","getChildren","getParent","Error","HistoryItem","word","toLocaleLowerCase","_onDidChangeTreeData","_disposables","_ctxHasHistory","_inputs","Map","clear","_reRunHistoryItem","Array","values","pop","guessedTrackedPosition","picks","pick","showQuickPick","placeHolder","delete","newPosition","isEqual","WordAnchor","JSON","stringify","all","reverse","_view","_delegate","_decorationType","createTextEditorDecorationType","backgroundColor","ThemeColor","rangeBehavior","DecorationRangeBehavior","ClosedClosed","overviewRulerLane","OverviewRulerLane","Center","overviewRulerColor","_ignore","Set","onDidChangeTextDocument","onDidChangeActiveTextEditor","onDidChangeVisibility","_show","_hide","onDidChangeSelection","editor","visibleTextEditors","setDecorations","viewColumn","has","ranges","getEditorHighlights","_ctxCanNavigate","previous","delegate","sel","Selection","_anchor","newItem","newLocation","_open"],"mappings":"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","file":"extension.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = require(\"vscode\");","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\n\nexport function del<T>(array: T[], e: T): void {\n\tconst idx = array.indexOf(e);\n\tif (idx >= 0) {\n\t\tarray.splice(idx, 1);\n\t}\n}\n\nexport function tail<T>(array: T[]): T | undefined {\n\treturn array[array.length - 1];\n}\n\nexport async function isValidRequestPosition(uri: vscode.Uri, position: vscode.Position) {\n\tconst doc = await vscode.workspace.openTextDocument(uri);\n\tlet range = doc.getWordRangeAtPosition(position);\n\tif (!range) {\n\t\trange = doc.getWordRangeAtPosition(position, /[^\\s]+/);\n\t}\n\treturn Boolean(range);\n}\n\nexport function getPreviewChunks(doc: vscode.TextDocument, range: vscode.Range, beforeLen: number = 8, trim: boolean = true) {\n\tlet previewStart = range.start.with({ character: Math.max(0, range.start.character - beforeLen) });\n\tlet wordRange = doc.getWordRangeAtPosition(previewStart);\n\tlet before = doc.getText(new vscode.Range(wordRange ? wordRange.start : previewStart, range.start));\n\tlet inside = doc.getText(range);\n\tlet previewEnd = range.end.translate(0, 331);\n\tlet after = doc.getText(new vscode.Range(range.end, previewEnd));\n\tif (trim) {\n\t\tbefore = before.replace(/^\\s*/g, '');\n\t\tafter = after.replace(/\\s*$/g, '');\n\t}\n\treturn { before, inside, after };\n}\n\nexport class ContextKey<V> {\n\n\tconstructor(readonly name: string) { }\n\n\tasync set(value: V) {\n\t\tawait vscode.commands.executeCommand('setContext', this.name, value);\n\t}\n\n\tasync reset() {\n\t\tawait vscode.commands.executeCommand('setContext', this.name, undefined);\n\t}\n}\n\nexport class WordAnchor {\n\n\tprivate readonly _version: number;\n\tprivate readonly _word: string | undefined;\n\n\tconstructor(private readonly _doc: vscode.TextDocument, private readonly _position: vscode.Position) {\n\t\tthis._version = _doc.version;\n\t\tthis._word = this._getAnchorWord(_doc, _position);\n\t}\n\n\tprivate _getAnchorWord(doc: vscode.TextDocument, pos: vscode.Position): string | undefined {\n\t\tconst range = doc.getWordRangeAtPosition(pos) || doc.getWordRangeAtPosition(pos, /[^\\s]+/);\n\t\treturn range && doc.getText(range);\n\t}\n\n\tguessedTrackedPosition(): vscode.Position | undefined {\n\t\t// funky entry\n\t\tif (!this._word) {\n\t\t\treturn this._position;\n\t\t}\n\n\t\t// no changes\n\t\tif (this._version === this._doc.version) {\n\t\t\treturn this._position;\n\t\t}\n\n\t\t// no changes here...\n\t\tconst wordNow = this._getAnchorWord(this._doc, this._position);\n\t\tif (this._word === wordNow) {\n\t\t\treturn this._position;\n\t\t}\n\n\t\t// changes: search _word downwards and upwards\n\t\tconst startLine = this._position.line;\n\t\tlet i = 0;\n\t\tlet line: number;\n\t\tlet checked: boolean;\n\t\tdo {\n\t\t\tchecked = false;\n\t\t\t// nth line down\n\t\t\tline = startLine + i;\n\t\t\tif (line < this._doc.lineCount) {\n\t\t\t\tchecked = true;\n\t\t\t\tlet ch = this._doc.lineAt(line).text.indexOf(this._word);\n\t\t\t\tif (ch >= 0) {\n\t\t\t\t\treturn new vscode.Position(line, ch);\n\t\t\t\t}\n\t\t\t}\n\t\t\ti += 1;\n\t\t\t// nth line up\n\t\t\tline = startLine - i;\n\t\t\tif (line >= 0) {\n\t\t\t\tchecked = true;\n\t\t\t\tlet ch = this._doc.lineAt(line).text.indexOf(this._word);\n\t\t\t\tif (ch >= 0) {\n\t\t\t\t\treturn new vscode.Position(line, ch);\n\t\t\t\t}\n\t\t\t}\n\t\t} while (i < 100 && checked);\n\n\t\t// fallback\n\t\treturn this._position;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport * as calls from './calls';\nimport * as references from './references';\nimport { SymbolTree, SymbolTreeInput } from './references-view';\nimport { SymbolsTree } from './tree';\n\nexport function activate(context: vscode.ExtensionContext): SymbolTree {\n\n\tconst tree = new SymbolsTree();\n\n\treferences.register(tree, context);\n\tcalls.register(tree, context);\n\n\tfunction setInput(input: SymbolTreeInput<unknown>) {\n\t\ttree.setInput(input);\n\t}\n\n\treturn { setInput };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolsTree } from '../tree';\nimport { ContextKey } from '../utils';\nimport { CallItem, CallsDirection, CallsTreeInput } from './model';\n\nexport function register(tree: SymbolsTree, context: vscode.ExtensionContext): void {\n\n\tconst direction = new RichCallsDirection(context.workspaceState, CallsDirection.Incoming);\n\n\tfunction showCallHierarchy() {\n\t\tif (vscode.window.activeTextEditor) {\n\t\t\tconst input = new CallsTreeInput(new vscode.Location(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active), direction.value);\n\t\t\ttree.setInput(input);\n\t\t}\n\t};\n\n\tfunction setCallsDirection(value: CallsDirection, anchor: CallItem | unknown) {\n\t\tdirection.value = value;\n\n\t\tlet newInput: CallsTreeInput | undefined;\n\t\tconst oldInput = tree.getInput();\n\t\tif (anchor instanceof CallItem) {\n\t\t\tnewInput = new CallsTreeInput(new vscode.Location(anchor.item.uri, anchor.item.range.start), direction.value);\n\t\t} else if (oldInput instanceof CallsTreeInput) {\n\t\t\tnewInput = new CallsTreeInput(oldInput.location, direction.value);\n\t\t}\n\t\tif (newInput) {\n\t\t\ttree.setInput(newInput);\n\t\t}\n\t}\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand('references-view.showCallHierarchy', showCallHierarchy),\n\t\tvscode.commands.registerCommand('references-view.showOutgoingCalls', (item: CallItem | unknown) => setCallsDirection(CallsDirection.Outgoing, item)),\n\t\tvscode.commands.registerCommand('references-view.showIncomingCalls', (item: CallItem | unknown) => setCallsDirection(CallsDirection.Incoming, item)),\n\t\tvscode.commands.registerCommand('references-view.showCallItem', showCallItem),\n\t\tvscode.commands.registerCommand('references-view.removeCallItem', removeCallItem)\n\t);\n}\n\nasync function showCallItem(item: CallItem | unknown, preserveFocus: boolean = false) {\n\tif (item instanceof CallItem) {\n\t\tawait vscode.commands.executeCommand('vscode.open', item.item.uri, {\n\t\t\tselection: new vscode.Range(item.item.selectionRange.start, item.item.selectionRange.start),\n\t\t\tpreserveFocus\n\t\t});\n\t}\n}\n\nfunction removeCallItem(item: CallItem | unknown): void {\n\tif (item instanceof CallItem) {\n\t\titem.remove();\n\t}\n}\n\nclass RichCallsDirection {\n\n\tprivate static _key = 'references-view.callHierarchyMode';\n\n\tprivate _ctxMode = new ContextKey<'showIncoming' | 'showOutgoing'>('references-view.callHierarchyMode');\n\n\tconstructor(\n\t\tprivate _mem: vscode.Memento,\n\t\tprivate _value: CallsDirection = CallsDirection.Outgoing,\n\t) {\n\t\tconst raw = _mem.get<number>(RichCallsDirection._key);\n\t\tif (typeof raw === 'number' && raw >= 0 && raw <= 1) {\n\t\t\tthis.value = raw;\n\t\t} else {\n\t\t\tthis.value = _value;\n\t\t}\n\t}\n\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tset value(value: CallsDirection) {\n\t\tthis._value = value;\n\t\tthis._ctxMode.set(this._value === CallsDirection.Incoming ? 'showIncoming' : 'showOutgoing');\n\t\tthis._mem.update(RichCallsDirection._key, value);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemEditorHighlights, SymbolItemNavigation, SymbolTreeInput } from '../references-view';\nimport { del, tail } from '../utils';\n\n\nexport class CallsTreeInput implements SymbolTreeInput<CallItem> {\n\n\treadonly title: string;\n\treadonly contextValue: string = 'callHierarchy';\n\n\tconstructor(\n\t\treadonly location: vscode.Location,\n\t\treadonly direction: CallsDirection,\n\t) {\n\t\tthis.title = direction === CallsDirection.Incoming\n\t\t\t? 'Callers Of'\n\t\t\t: 'Calls From';\n\t}\n\n\tasync resolve() {\n\n\t\tconst items = await Promise.resolve(vscode.commands.executeCommand<vscode.CallHierarchyItem[]>('vscode.prepareCallHierarchy', this.location.uri, this.location.range.start));\n\t\tconst model = new CallsModel(this.direction, items ?? []);\n\t\tconst provider = new CallItemDataProvider(model);\n\n\t\tif (model.roots.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tprovider,\n\t\t\tget message() { return model.roots.length === 0 ? 'No results.' : undefined; },\n\t\t\tnavigation: model,\n\t\t\thighlights: model,\n\t\t\tdispose() {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\twith(location: vscode.Location): CallsTreeInput {\n\t\treturn new CallsTreeInput(location, this.direction);\n\t}\n}\n\n\nexport const enum CallsDirection {\n\tIncoming,\n\tOutgoing\n}\n\n\n\nexport class CallItem {\n\n\tchildren?: CallItem[];\n\n\tconstructor(\n\t\treadonly model: CallsModel,\n\t\treadonly item: vscode.CallHierarchyItem,\n\t\treadonly parent: CallItem | undefined,\n\t\treadonly locations: vscode.Location[] | undefined\n\t) { }\n\n\tremove(): void {\n\t\tthis.model.remove(this);\n\t}\n}\n\nclass CallsModel implements SymbolItemNavigation<CallItem>, SymbolItemEditorHighlights<CallItem> {\n\n\treadonly roots: CallItem[] = [];\n\n\tprivate readonly _onDidChange = new vscode.EventEmitter<CallsModel>();\n\treadonly onDidChange = this._onDidChange.event;\n\n\tconstructor(readonly direction: CallsDirection, items: vscode.CallHierarchyItem[]) {\n\t\tthis.roots = items.map(item => new CallItem(this, item, undefined, undefined));\n\t}\n\n\tprivate async _resolveCalls(call: CallItem): Promise<CallItem[]> {\n\t\tif (this.direction === CallsDirection.Incoming) {\n\t\t\tconst calls = await vscode.commands.executeCommand<vscode.CallHierarchyIncomingCall[]>('vscode.provideIncomingCalls', call.item);\n\t\t\treturn calls ? calls.map(item => new CallItem(this, item.from, call, item.fromRanges.map(range => new vscode.Location(item.from.uri, range)))) : [];\n\t\t} else {\n\t\t\tconst calls = await vscode.commands.executeCommand<vscode.CallHierarchyOutgoingCall[]>('vscode.provideOutgoingCalls', call.item);\n\t\t\treturn calls ? calls.map(item => new CallItem(this, item.to, call, item.fromRanges.map(range => new vscode.Location(call.item.uri, range)))) : [];\n\t\t}\n\t}\n\n\tasync getCallChildren(call: CallItem): Promise<CallItem[]> {\n\t\tif (!call.children) {\n\t\t\tcall.children = await this._resolveCalls(call);\n\t\t}\n\t\treturn call.children;\n\t}\n\n\t// -- navigation \n\n\tlocation(item: CallItem) {\n\t\treturn new vscode.Location(item.item.uri, item.item.range);\n\t}\n\n\tnearest(uri: vscode.Uri, _position: vscode.Position): CallItem | undefined {\n\t\treturn this.roots.find(item => item.item.uri.toString() === uri.toString()) ?? this.roots[0];\n\t}\n\n\tnext(from: CallItem): CallItem {\n\t\treturn this._move(from, true) ?? from;\n\t}\n\n\tprevious(from: CallItem): CallItem {\n\t\treturn this._move(from, false) ?? from;\n\t}\n\n\tprivate _move(item: CallItem, fwd: boolean) {\n\t\tif (item.children?.length) {\n\t\t\treturn fwd ? item.children[0] : tail(item.children);\n\t\t}\n\t\tconst array = this.roots.includes(item) ? this.roots : item.parent?.children;\n\t\tif (array?.length) {\n\t\t\tconst idx = array.indexOf(item);\n\t\t\tconst delta = fwd ? 1 : -1;\n\t\t\treturn array[idx + delta + array.length % array.length];\n\t\t}\n\t}\n\n\t// --- highlights\n\n\tgetEditorHighlights(item: CallItem, uri: vscode.Uri): vscode.Range[] | undefined {\n\t\tif (!item.locations) {\n\t\t\treturn item.item.uri.toString() === uri.toString() ? [item.item.selectionRange] : undefined;\n\t\t}\n\t\treturn item.locations\n\t\t\t.filter(loc => loc.uri.toString() === uri.toString())\n\t\t\t.map(loc => loc.range);\n\t}\n\n\tremove(item: CallItem) {\n\t\tconst isInRoot = this.roots.includes(item);\n\t\tconst siblings = isInRoot ? this.roots : item.parent?.children;\n\t\tif (siblings) {\n\t\t\tdel(siblings, item);\n\t\t\tthis._onDidChange.fire(this);\n\t\t}\n\t}\n}\n\nclass CallItemDataProvider implements vscode.TreeDataProvider<CallItem> {\n\n\tprivate readonly _emitter = new vscode.EventEmitter<CallItem | undefined>();\n\treadonly onDidChangeTreeData = this._emitter.event;\n\n\tprivate readonly _modelListener: vscode.Disposable;\n\n\tconstructor(private _model: CallsModel) {\n\t\tthis._modelListener = _model.onDidChange(e => this._emitter.fire(e instanceof CallItem ? e : undefined));\n\t}\n\n\tdispose(): void {\n\t\tthis._emitter.dispose();\n\t\tthis._modelListener.dispose();\n\t}\n\n\tgetTreeItem(element: CallItem): vscode.TreeItem {\n\n\t\tconst item = new vscode.TreeItem(element.item.name);\n\t\titem.description = element.item.detail;\n\t\titem.contextValue = 'call-item';\n\t\titem.iconPath = CallItemDataProvider._getThemeIcon(element.item.kind);\n\t\titem.command = { command: 'references-view.showCallItem', title: 'Open Call', arguments: [element, true] };\n\t\titem.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n\t\treturn item;\n\t}\n\n\tgetChildren(element?: CallItem | undefined) {\n\t\treturn element\n\t\t\t? this._model.getCallChildren(element)\n\t\t\t: this._model.roots;\n\t}\n\n\tgetParent(element: CallItem) {\n\t\treturn element.parent;\n\t}\n\n\t// vscode.SymbolKind.File === 0, Module === 1, etc...\n\tprivate static _themeIconIds = [\n\t\t'symbol-file', 'symbol-module', 'symbol-namespace', 'symbol-package', 'symbol-class', 'symbol-method',\n\t\t'symbol-property', 'symbol-field', 'symbol-constructor', 'symbol-enum', 'symbol-interface',\n\t\t'symbol-function', 'symbol-variable', 'symbol-constant', 'symbol-string', 'symbol-number', 'symbol-boolean',\n\t\t'symbol-array', 'symbol-object', 'symbol-key', 'symbol-null', 'symbol-enum-member', 'symbol-struct',\n\t\t'symbol-event', 'symbol-operator', 'symbol-type-parameter'\n\t];\n\n\tprivate static _getThemeIcon(kind: vscode.SymbolKind): vscode.ThemeIcon | undefined {\n\t\tlet id = CallItemDataProvider._themeIconIds[kind];\n\t\treturn id && new vscode.ThemeIcon(id);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolsTree } from '../tree';\nimport { FileItem, ReferenceItem, ReferencesModel, ReferencesTreeInput } from './model';\n\nexport function register(tree: SymbolsTree, context: vscode.ExtensionContext): void {\n\n\tfunction findLocations(title: string, command: string) {\n\t\tif (vscode.window.activeTextEditor) {\n\t\t\tconst input = new ReferencesTreeInput(title, new vscode.Location(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active), command);\n\t\t\ttree.setInput(input);\n\t\t}\n\t}\n\n\tcontext.subscriptions.push(\n\t\tvscode.commands.registerCommand('references-view.findReferences', () => findLocations('References', 'vscode.executeReferenceProvider')),\n\t\tvscode.commands.registerCommand('references-view.findImplementations', () => findLocations('Implementations', 'vscode.executeImplementationProvider')),\n\t\t// --- legacy name\n\t\tvscode.commands.registerCommand('references-view.find', (...args: any[]) => vscode.commands.executeCommand('references-view.findReferences', ...args)),\n\t\tvscode.commands.registerCommand('references-view.showReferenceItem', showReferenceItem),\n\t\tvscode.commands.registerCommand('references-view.removeReferenceItem', removeReferenceItem),\n\t\tvscode.commands.registerCommand('references-view.copy', copyCommand),\n\t\tvscode.commands.registerCommand('references-view.copyAll', copyAllCommand),\n\t\tvscode.commands.registerCommand('references-view.copyPath', copyPathCommand),\n\t);\n\n\n\t// --- references.preferredLocation setting\n\n\tlet showReferencesDisposable: vscode.Disposable | undefined;\n\tconst config = 'references.preferredLocation';\n\tfunction updateShowReferences(event?: vscode.ConfigurationChangeEvent) {\n\t\tif (event && !event.affectsConfiguration(config)) {\n\t\t\treturn;\n\t\t}\n\t\tconst value = vscode.workspace.getConfiguration().get<string>(config);\n\n\t\tshowReferencesDisposable?.dispose();\n\t\tshowReferencesDisposable = undefined;\n\n\t\tif (value === 'view') {\n\t\t\tshowReferencesDisposable = vscode.commands.registerCommand('editor.action.showReferences', async (uri: vscode.Uri, position: vscode.Position, locations: vscode.Location[]) => {\n\t\t\t\tconst input = new ReferencesTreeInput('References', new vscode.Location(uri, position), 'vscode.executeReferenceProvider', locations);\n\t\t\t\ttree.setInput(input);\n\t\t\t});\n\t\t}\n\t};\n\tcontext.subscriptions.push(vscode.workspace.onDidChangeConfiguration(updateShowReferences));\n\tcontext.subscriptions.push({ dispose: () => showReferencesDisposable?.dispose() });\n\tupdateShowReferences();\n}\n\nconst copyAllCommand = async (item: ReferenceItem | FileItem | unknown) => {\n\tif (item instanceof ReferenceItem) {\n\t\tcopyCommand(item.file.model);\n\t} else if (item instanceof FileItem) {\n\t\tcopyCommand(item.model);\n\t}\n};\n\nfunction showReferenceItem(item: ReferenceItem | unknown, preserveFocus: boolean = false) {\n\tif (item instanceof ReferenceItem) {\n\t\treturn vscode.commands.executeCommand('vscode.open', item.location.uri, {\n\t\t\tselection: new vscode.Range(item.location.range.start, item.location.range.start),\n\t\t\tpreserveFocus\n\t\t});\n\t}\n}\nfunction removeReferenceItem(item: FileItem | ReferenceItem | unknown) {\n\tif (item instanceof FileItem) {\n\t\titem.remove();\n\t} else if (item instanceof ReferenceItem) {\n\t\titem.remove();\n\t}\n}\n\n\nasync function copyCommand(item: ReferencesModel | ReferenceItem | FileItem | unknown) {\n\tlet val: string | undefined;\n\tif (item instanceof ReferencesModel) {\n\t\tval = await item.asCopyText();\n\t} else if (item instanceof ReferenceItem) {\n\t\tval = await item.asCopyText();\n\t} else if (item instanceof FileItem) {\n\t\tval = await item.asCopyText();\n\t}\n\tif (val) {\n\t\tawait vscode.env.clipboard.writeText(val);\n\t}\n};\n\nasync function copyPathCommand(item: FileItem | unknown) {\n\tif (item instanceof FileItem) {\n\t\tif (item.uri.scheme === 'file') {\n\t\t\tvscode.env.clipboard.writeText(item.uri.fsPath);\n\t\t} else {\n\t\t\tvscode.env.clipboard.writeText(item.uri.toString(true));\n\t\t}\n\t}\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemEditorHighlights, SymbolItemNavigation, SymbolTreeInput } from '../references-view';\nimport { del, getPreviewChunks, tail } from '../utils';\n\nexport class ReferencesTreeInput implements SymbolTreeInput<FileItem | ReferenceItem> {\n\n\treadonly contextValue: string;\n\n\tconstructor(\n\t\treadonly title: string,\n\t\treadonly location: vscode.Location,\n\t\tprivate readonly _command: string,\n\t\tprivate readonly _result?: vscode.Location[] | vscode.LocationLink[]\n\t) {\n\t\tthis.contextValue = _command;\n\t}\n\n\tasync resolve() {\n\n\t\tlet model: ReferencesModel;\n\t\tif (this._result) {\n\t\t\tmodel = new ReferencesModel(this._result);\n\t\t} else {\n\t\t\tconst resut = await Promise.resolve(vscode.commands.executeCommand<vscode.Location[] | vscode.LocationLink[]>(this._command, this.location.uri, this.location.range.start));\n\t\t\tmodel = new ReferencesModel(resut ?? []);\n\t\t}\n\n\t\tif (model.items.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = new ReferencesTreeDataProvider(model);\n\n\t\treturn {\n\t\t\tprovider,\n\t\t\tget message() { return model.message; },\n\t\t\tnavigation: model,\n\t\t\thighlights: model,\n\t\t\tdispose(): void {\n\t\t\t\tprovider.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\twith(location: vscode.Location): ReferencesTreeInput {\n\t\treturn new ReferencesTreeInput(this.title, location, this._command);\n\t}\n}\n\nexport class ReferencesModel implements SymbolItemNavigation<FileItem | ReferenceItem>, SymbolItemEditorHighlights<FileItem | ReferenceItem> {\n\n\tprivate _onDidChange = new vscode.EventEmitter<FileItem | ReferenceItem | undefined>();\n\treadonly onDidChangeTreeData = this._onDidChange.event;\n\n\treadonly items: FileItem[] = [];\n\n\tconstructor(locations: vscode.Location[] | vscode.LocationLink[]) {\n\t\tlet last: FileItem | undefined;\n\t\tfor (const item of locations.sort(ReferencesModel._compareLocations)) {\n\t\t\tconst loc = item instanceof vscode.Location\n\t\t\t\t? item\n\t\t\t\t: new vscode.Location(item.targetUri, item.targetRange);\n\n\t\t\tif (!last || ReferencesModel._compareUriIgnoreFragment(last.uri, loc.uri) !== 0) {\n\t\t\t\tlast = new FileItem(loc.uri.with({ fragment: '' }), [], this);\n\t\t\t\tthis.items.push(last);\n\t\t\t}\n\t\t\tlast.references.push(new ReferenceItem(loc, last));\n\t\t}\n\t}\n\n\tprivate static _compareUriIgnoreFragment(a: vscode.Uri, b: vscode.Uri): number {\n\t\tlet aStr = a.with({ fragment: '' }).toString();\n\t\tlet bStr = b.with({ fragment: '' }).toString();\n\t\tif (aStr < bStr) {\n\t\t\treturn -1;\n\t\t} else if (aStr > bStr) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tprivate static _compareLocations(a: vscode.Location | vscode.LocationLink, b: vscode.Location | vscode.LocationLink): number {\n\t\tlet aUri = a instanceof vscode.Location ? a.uri : a.targetUri;\n\t\tlet bUri = b instanceof vscode.Location ? b.uri : b.targetUri;\n\t\tif (aUri.toString() < bUri.toString()) {\n\t\t\treturn -1;\n\t\t} else if (aUri.toString() > bUri.toString()) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tlet aRange = a instanceof vscode.Location ? a.range : a.targetRange;\n\t\tlet bRange = b instanceof vscode.Location ? b.range : b.targetRange;\n\t\tif (aRange.start.isBefore(bRange.start)) {\n\t\t\treturn -1;\n\t\t} else if (aRange.start.isAfter(bRange.start)) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\t// --- adapter\n\n\tget message() {\n\t\tif (this.items.length === 0) {\n\t\t\treturn 'No results.';\n\t\t}\n\t\tconst total = this.items.reduce((prev, cur) => prev + cur.references.length, 0);\n\t\tconst files = this.items.length;\n\t\tif (total === 1 && files === 1) {\n\t\t\treturn `${total} result in ${files} file`;\n\t\t} else if (total === 1) {\n\t\t\treturn `${total} result in ${files} files`;\n\t\t} else if (files === 1) {\n\t\t\treturn `${total} results in ${files} file`;\n\t\t} else {\n\t\t\treturn `${total} results in ${files} files`;\n\t\t}\n\t}\n\n\tlocation(item: FileItem | ReferenceItem) {\n\t\treturn item instanceof ReferenceItem ? item.location : undefined;\n\t}\n\n\tnearest(uri: vscode.Uri, position: vscode.Position): FileItem | ReferenceItem | undefined {\n\n\t\tif (this.items.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\t// NOTE: this.items is sorted by location (uri/range)\n\t\tfor (const item of this.items) {\n\t\t\tif (item.uri.toString() === uri.toString()) {\n\t\t\t\t// (1) pick the item at the request position\n\t\t\t\tfor (const ref of item.references) {\n\t\t\t\t\tif (ref.location.range.contains(position)) {\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// (2) pick the first item after or last before the request position\n\t\t\t\tlet lastBefore: ReferenceItem | undefined;\n\t\t\t\tfor (const ref of item.references) {\n\t\t\t\t\tif (ref.location.range.end.isAfter(position)) {\n\t\t\t\t\t\treturn ref;\n\t\t\t\t\t}\n\t\t\t\t\tlastBefore = ref;\n\t\t\t\t}\n\t\t\t\tif (lastBefore) {\n\t\t\t\t\treturn lastBefore;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// (3) pick the file with the longest common prefix\n\t\tlet best = 0;\n\t\tlet bestValue = ReferencesModel._prefixLen(this.items[best].toString(), uri.toString());\n\n\t\tfor (let i = 1; i < this.items.length; i++) {\n\t\t\tlet value = ReferencesModel._prefixLen(this.items[i].uri.toString(), uri.toString());\n\t\t\tif (value > bestValue) {\n\t\t\t\tbest = i;\n\t\t\t}\n\t\t}\n\n\t\treturn this.items[best].references[0];\n\t}\n\n\tprivate static _prefixLen(a: string, b: string): number {\n\t\tlet pos = 0;\n\t\twhile (pos < a.length && pos < b.length && a.charCodeAt(pos) === b.charCodeAt(pos)) {\n\t\t\tpos += 1;\n\t\t}\n\t\treturn pos;\n\t}\n\n\tnext(item: FileItem | ReferenceItem): FileItem | ReferenceItem {\n\t\treturn this._move(item, true) ?? item;\n\t}\n\n\tprevious(item: FileItem | ReferenceItem): FileItem | ReferenceItem {\n\t\treturn this._move(item, false) ?? item;\n\t}\n\n\tprivate _move(item: FileItem | ReferenceItem, fwd: boolean): ReferenceItem | undefined {\n\n\t\tconst delta = fwd ? +1 : -1;\n\n\t\tconst _move = (item: FileItem): FileItem => {\n\t\t\tconst idx = (this.items.indexOf(item) + delta + this.items.length) % this.items.length;\n\t\t\treturn this.items[idx];\n\t\t};\n\n\t\tif (item instanceof FileItem) {\n\t\t\tif (fwd) {\n\t\t\t\treturn _move(item).references[0];\n\t\t\t} else {\n\t\t\t\treturn tail(_move(item).references);\n\t\t\t}\n\t\t}\n\n\t\tif (item instanceof ReferenceItem) {\n\t\t\tconst idx = item.file.references.indexOf(item) + delta;\n\t\t\tif (idx < 0) {\n\t\t\t\treturn tail(_move(item.file).references);\n\t\t\t} else if (idx >= item.file.references.length) {\n\t\t\t\treturn _move(item.file).references[0];\n\t\t\t} else {\n\t\t\t\treturn item.file.references[idx];\n\t\t\t}\n\t\t}\n\t}\n\n\tgetEditorHighlights(_item: FileItem | ReferenceItem, uri: vscode.Uri): vscode.Range[] | undefined {\n\t\tconst file = this.items.find(file => file.uri.toString() === uri.toString());\n\t\treturn file?.references.map(ref => ref.location.range);\n\t}\n\n\tremove(item: FileItem | ReferenceItem) {\n\t\tif (item instanceof FileItem) {\n\t\t\tdel(this.items, item);\n\t\t\tthis._onDidChange.fire(undefined);\n\t\t} else {\n\t\t\tdel(item.file.references, item);\n\t\t\tif (item.file.references.length === 0) {\n\t\t\t\tdel(this.items, item.file);\n\t\t\t\tthis._onDidChange.fire(undefined);\n\t\t\t} else {\n\t\t\t\tthis._onDidChange.fire(item.file);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync asCopyText() {\n\t\tlet result = '';\n\t\tfor (const item of this.items) {\n\t\t\tresult += `${await item.asCopyText()}\\n`;\n\t\t}\n\t\treturn result;\n\t}\n\n}\n\nclass ReferencesTreeDataProvider implements Required<vscode.TreeDataProvider<FileItem | ReferenceItem>>{\n\n\tprivate readonly _listener: vscode.Disposable;\n\tprivate readonly _onDidChange = new vscode.EventEmitter<FileItem | ReferenceItem | undefined>();\n\n\treadonly onDidChangeTreeData = this._onDidChange.event;\n\n\tconstructor(private readonly _model: ReferencesModel) {\n\t\tthis._listener = _model.onDidChangeTreeData(e => this._onDidChange.fire());\n\t}\n\n\tdispose(): void {\n\t\tthis._onDidChange.dispose();\n\t\tthis._listener.dispose();\n\t}\n\n\tasync getTreeItem(element: FileItem | ReferenceItem) {\n\t\tif (element instanceof FileItem) {\n\t\t\t// files\n\t\t\tconst result = new vscode.TreeItem(element.uri);\n\t\t\tresult.contextValue = 'file-item';\n\t\t\tresult.description = true;\n\t\t\tresult.iconPath = vscode.ThemeIcon.File;\n\t\t\tresult.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n\t\t\treturn result;\n\n\t\t} else {\n\t\t\t// references\n\t\t\tconst { range } = element.location;\n\t\t\tconst doc = await element.getDocument(true);\n\t\t\tconst { before, inside, after } = getPreviewChunks(doc, range);\n\n\t\t\tconst label: vscode.TreeItemLabel = {\n\t\t\t\tlabel: before + inside + after,\n\t\t\t\thighlights: [[before.length, before.length + inside.length]]\n\t\t\t};\n\n\t\t\tconst result = new vscode.TreeItem2(label);\n\t\t\tresult.collapsibleState = vscode.TreeItemCollapsibleState.None;\n\t\t\tresult.contextValue = 'reference-item';\n\t\t\tresult.command = { command: 'references-view.showReferenceItem', title: 'Open Reference', arguments: [element, true] };\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tasync getChildren(element?: FileItem | ReferenceItem) {\n\t\tif (!element) {\n\t\t\treturn this._model.items;\n\t\t}\n\t\tif (element instanceof FileItem) {\n\t\t\treturn element.references;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetParent(element: FileItem | ReferenceItem) {\n\t\treturn element instanceof ReferenceItem ? element.file : undefined;\n\t}\n}\n\nexport class FileItem {\n\n\tconstructor(\n\t\treadonly uri: vscode.Uri,\n\t\treadonly references: Array<ReferenceItem>,\n\t\treadonly model: ReferencesModel\n\t) { }\n\n\t// --- adapter\n\n\tremove(): void {\n\t\tthis.model.remove(this);\n\t}\n\n\tasync asCopyText() {\n\t\tlet result = `${vscode.workspace.asRelativePath(this.uri)}\\n`;\n\t\tfor (let ref of this.references) {\n\t\t\tresult += `  ${await ref.asCopyText()}\\n`;\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport class ReferenceItem {\n\n\tprivate _document: Thenable<vscode.TextDocument> | undefined;\n\n\tconstructor(\n\t\treadonly location: vscode.Location,\n\t\treadonly file: FileItem,\n\t) { }\n\n\tasync getDocument(warmUpNext?: boolean) {\n\t\tif (!this._document) {\n\t\t\tthis._document = vscode.workspace.openTextDocument(this.location.uri);\n\t\t}\n\t\tif (warmUpNext) {\n\t\t\t// load next document once this document has been loaded\n\t\t\tconst next = this.file.model.next(this.file);\n\t\t\tif (next instanceof FileItem && next !== this.file) {\n\t\t\t\tvscode.workspace.openTextDocument(next.uri);\n\t\t\t} else if (next instanceof ReferenceItem) {\n\t\t\t\tvscode.workspace.openTextDocument(next.location.uri);\n\t\t\t}\n\t\t}\n\t\treturn this._document;\n\t}\n\n\t// --- adapter\n\n\tremove(): void {\n\t\tthis.file.model.remove(this);\n\t}\n\n\tasync asCopyText() {\n\t\tlet doc = await this.getDocument();\n\t\tlet chunks = getPreviewChunks(doc, this.location.range, 21, false);\n\t\treturn `${this.location.range.start.line + 1}, ${this.location.range.start.character + 1}: ${chunks.before + chunks.inside + chunks.after}`;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { EditorHighlights } from './highlights';\nimport { Navigation } from './navigation';\nimport { SymbolTreeInput } from './references-view';\nimport { ContextKey, isValidRequestPosition, WordAnchor } from './utils';\n\nexport class SymbolsTree {\n\n\treadonly viewId = 'references-view.tree';\n\n\tprivate readonly _ctxIsActive = new ContextKey<boolean>('reference-list.isActive');\n\tprivate readonly _ctxHasResult = new ContextKey<boolean>('reference-list.hasResult');\n\tprivate readonly _ctxInputSource = new ContextKey<string>('reference-list.source');\n\n\tprivate readonly _history = new TreeInputHistory(this);\n\tprivate readonly _provider = new TreeDataProviderDelegate();\n\tprivate readonly _tree: vscode.TreeView<unknown>;\n\tprivate readonly _navigation: Navigation;\n\n\tprivate _input?: SymbolTreeInput<unknown>;\n\tprivate _sessionDisposable?: vscode.Disposable;\n\n\tconstructor() {\n\t\tthis._tree = vscode.window.createTreeView<unknown>(this.viewId, {\n\t\t\ttreeDataProvider: this._provider,\n\t\t\tshowCollapseAll: true\n\t\t});\n\t\tthis._navigation = new Navigation(this._tree);\n\t}\n\n\tdispose(): void {\n\t\tthis._history.dispose();\n\t\tthis._tree.dispose();\n\t\tthis._sessionDisposable?.dispose();\n\t}\n\n\tgetInput(): SymbolTreeInput<unknown> | undefined {\n\t\treturn this._input;\n\t}\n\n\tasync setInput(input: SymbolTreeInput<unknown>) {\n\n\t\tif (!await isValidRequestPosition(input.location.uri, input.location.range.start)) {\n\t\t\tthis.clearInput();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._ctxInputSource.set(input.contextValue);\n\t\tthis._ctxIsActive.set(true);\n\t\tthis._ctxHasResult.set(true);\n\t\tvscode.commands.executeCommand(`${this.viewId}.focus`);\n\n\t\tconst newInputKind = !this._input || Object.getPrototypeOf(this._input) !== Object.getPrototypeOf(input);\n\t\tthis._input = input;\n\t\tthis._sessionDisposable?.dispose();\n\n\t\tthis._tree.title = input.title;\n\t\tthis._tree.message = newInputKind ? undefined : this._tree.message;\n\n\t\tconst modelPromise = Promise.resolve(input.resolve());\n\n\t\t// set promise to tree data provider to trigger tree loading UI\n\t\tthis._provider.update(modelPromise.then(model => model?.provider ?? this._history));\n\n\t\tconst model = await modelPromise;\n\t\tif (this._input !== input) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!model) {\n\t\t\tthis.clearInput();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._history.add(input);\n\t\tthis._tree.message = model.message;\n\n\t\t// navigation\n\t\tthis._navigation.update(model.navigation);\n\n\t\t// reveal & select\n\t\tconst selection = model.navigation?.nearest(input.location.uri, input.location.range.start);\n\t\tif (selection && this._tree.visible) {\n\t\t\tawait this._tree.reveal(selection, { select: true, focus: true, expand: true });\n\t\t}\n\n\t\tconst disposables: vscode.Disposable[] = [];\n\n\t\t// editor highlights\n\t\tlet highlights: EditorHighlights<unknown> | undefined;\n\t\tif (model.highlights) {\n\t\t\thighlights = new EditorHighlights(this._tree, model.highlights);\n\t\t\tdisposables.push(highlights);\n\t\t}\n\n\t\t// listener\n\t\tif (model.provider.onDidChangeTreeData) {\n\t\t\tdisposables.push(model.provider.onDidChangeTreeData(() => {\n\t\t\t\tthis._tree.title = input.title;\n\t\t\t\tthis._tree.message = model.message;\n\t\t\t\thighlights?.update();\n\t\t\t}));\n\t\t}\n\t\tif (typeof model.dispose === 'function') {\n\t\t\tdisposables.push(new vscode.Disposable(() => model.dispose!()));\n\t\t}\n\t\tthis._sessionDisposable = vscode.Disposable.from(...disposables);\n\t}\n\n\tclearInput(): void {\n\t\tthis._sessionDisposable?.dispose();\n\t\tthis._input = undefined;\n\t\tthis._ctxHasResult.set(false);\n\t\tthis._ctxInputSource.reset();\n\t\tthis._tree.title = 'References';\n\t\tthis._tree.message = this._history.size === 0 ? 'No results.' : 'No results. Try running a previous search again:';\n\t\tthis._provider.update(Promise.resolve(this._history));\n\t}\n}\n\n// --- tree data\n\ninterface ActiveTreeDataProviderWrapper {\n\tprovider: Promise<vscode.TreeDataProvider<any>>;\n}\n\nclass TreeDataProviderDelegate implements vscode.TreeDataProvider<undefined> {\n\n\tprovider?: Promise<vscode.TreeDataProvider<any>>;\n\n\tprivate _sessionDispoables?: vscode.Disposable;\n\tprivate _onDidChange = new vscode.EventEmitter<any>();\n\n\treadonly onDidChangeTreeData = this._onDidChange.event;\n\n\tupdate(provider: Promise<vscode.TreeDataProvider<any>>) {\n\n\t\tthis._sessionDispoables?.dispose();\n\t\tthis._sessionDispoables = undefined;\n\n\t\tthis._onDidChange.fire();\n\n\t\tthis.provider = provider;\n\n\t\tprovider.then(value => {\n\t\t\tif (this.provider === provider && value.onDidChangeTreeData) {\n\t\t\t\tthis._sessionDispoables = value.onDidChangeTreeData(this._onDidChange.fire, this._onDidChange);\n\t\t\t}\n\t\t}).catch(err => {\n\t\t\tthis.provider = undefined;\n\t\t\tconsole.error(err);\n\t\t});\n\t}\n\n\tasync getTreeItem(element: unknown) {\n\t\tthis._assertProvider();\n\t\treturn (await this.provider).getTreeItem(element);\n\t}\n\n\tasync getChildren(parent?: unknown | undefined) {\n\t\tthis._assertProvider();\n\t\treturn (await this.provider).getChildren(parent);\n\t}\n\n\tasync getParent(element: unknown) {\n\t\tthis._assertProvider();\n\t\tconst provider = await this.provider;\n\t\treturn provider.getParent ? provider.getParent(element) : undefined;\n\t}\n\n\tprivate _assertProvider(): asserts this is ActiveTreeDataProviderWrapper {\n\t\tif (!this.provider) {\n\t\t\tthrow new Error('MISSING provider');\n\t\t}\n\t}\n}\n\n// --- history\n\nclass HistoryItem {\n\n\treadonly description: string;\n\n\tconstructor(\n\t\treadonly key: string,\n\t\treadonly word: string,\n\t\treadonly anchor: WordAnchor,\n\t\treadonly input: SymbolTreeInput<unknown>,\n\t) {\n\t\tthis.description = `${vscode.workspace.asRelativePath(input.location.uri)}  ${input.title.toLocaleLowerCase()}`;\n\t}\n}\n\nclass TreeInputHistory implements vscode.TreeDataProvider<HistoryItem>{\n\n\tprivate readonly _onDidChangeTreeData = new vscode.EventEmitter<HistoryItem | undefined>();\n\treadonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n\tprivate readonly _disposables: vscode.Disposable[] = [];\n\tprivate readonly _ctxHasHistory = new ContextKey<boolean>('reference-list.hasHistory');\n\tprivate readonly _inputs = new Map<string, HistoryItem>();\n\n\tconstructor(private readonly _tree: SymbolsTree) {\n\n\t\tthis._disposables.push(\n\t\t\tvscode.commands.registerCommand('references-view.clear', () => _tree.clearInput()),\n\t\t\tvscode.commands.registerCommand('references-view.clearHistory', () => {\n\t\t\t\tthis.clear();\n\t\t\t\t_tree.clearInput();\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('references-view.refind', (item) => {\n\t\t\t\tif (item instanceof HistoryItem) {\n\t\t\t\t\tthis._reRunHistoryItem(item);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('references-view.refresh', () => {\n\t\t\t\tconst item = Array.from(this._inputs.values()).pop();\n\t\t\t\tif (item) {\n\t\t\t\t\tthis._reRunHistoryItem(item);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('_references-view.showHistoryItem', (item) => {\n\t\t\t\tif (item instanceof HistoryItem) {\n\t\t\t\t\tconst position = item.anchor.guessedTrackedPosition() ?? item.input.location.range.start;\n\t\t\t\t\treturn vscode.commands.executeCommand('vscode.open', item.input.location.uri, { selection: new vscode.Range(position, position) });\n\t\t\t\t}\n\t\t\t}),\n\t\t\tvscode.commands.registerCommand('references-view.pickFromHistory', async () => {\n\t\t\t\tinterface HistoryPick extends vscode.QuickPickItem {\n\t\t\t\t\titem: HistoryItem;\n\t\t\t\t}\n\t\t\t\tconst entries = await this.getChildren();\n\t\t\t\tconst picks = entries.map(item => <HistoryPick>{\n\t\t\t\t\tlabel: item.word,\n\t\t\t\t\tdescription: item.description,\n\t\t\t\t\titem\n\t\t\t\t});\n\t\t\t\tconst pick = await vscode.window.showQuickPick(picks, { placeHolder: 'Select previous reference search' });\n\t\t\t\tif (pick) {\n\t\t\t\t\tthis._reRunHistoryItem(pick.item);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tdispose(): void {\n\t\tvscode.Disposable.from(...this._disposables).dispose();\n\t\tthis._onDidChangeTreeData.dispose();\n\t}\n\n\tprivate _reRunHistoryItem(item: HistoryItem): void {\n\t\tthis._inputs.delete(item.key);\n\t\tconst newPosition = item.anchor.guessedTrackedPosition();\n\t\tlet newInput = item.input;\n\t\t// create a new input when having a tracked position which is\n\t\t// different than the original position.\n\t\tif (newPosition && !item.input.location.range.start.isEqual(newPosition)) {\n\t\t\tnewInput = item.input.with(new vscode.Location(item.input.location.uri, newPosition));\n\t\t}\n\t\tthis._tree.setInput(newInput);\n\t}\n\n\tasync add(input: SymbolTreeInput<unknown>) {\n\n\t\tconst doc = await vscode.workspace.openTextDocument(input.location.uri);\n\n\t\tconst anchor = new WordAnchor(doc, input.location.range.start);\n\t\tconst range = doc.getWordRangeAtPosition(input.location.range.start) ?? doc.getWordRangeAtPosition(input.location.range.start, /[^\\s]+/);\n\t\tconst word = range ? doc.getText(range) : '???';\n\n\t\tconst item = new HistoryItem(JSON.stringify([range?.start ?? input.location.range.start, input.location.uri, input.title]), word, anchor, input);\n\t\t// use filo-ordering of native maps\n\t\tthis._inputs.delete(item.key);\n\t\tthis._inputs.set(item.key, item);\n\t\tthis._ctxHasHistory.set(true);\n\t}\n\n\tclear(): void {\n\t\tthis._inputs.clear();\n\t\tthis._ctxHasHistory.set(false);\n\t\tthis._onDidChangeTreeData.fire(undefined);\n\t}\n\n\tget size() {\n\t\treturn this._inputs.size;\n\t}\n\n\t// --- tree data provider\n\n\tgetTreeItem(item: HistoryItem): vscode.TreeItem {\n\t\tconst result = new vscode.TreeItem(item.word);\n\t\tresult.description = item.description;\n\t\tresult.command = { command: '_references-view.showHistoryItem', arguments: [item], title: 'Rerun' };\n\t\tresult.collapsibleState = vscode.TreeItemCollapsibleState.None;\n\t\tresult.contextValue = 'history-item';\n\t\treturn result;\n\t}\n\n\tgetChildren() {\n\t\treturn Promise.all([...this._inputs.values()].reverse());\n\t}\n\n\tgetParent() {\n\t\treturn undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemEditorHighlights } from './references-view';\n\nexport class EditorHighlights<T> {\n\n\tprivate readonly _decorationType = vscode.window.createTextEditorDecorationType({\n\t\tbackgroundColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n\t\trangeBehavior: vscode.DecorationRangeBehavior.ClosedClosed,\n\t\toverviewRulerLane: vscode.OverviewRulerLane.Center,\n\t\toverviewRulerColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n\t});\n\n\tprivate readonly disposables: vscode.Disposable[] = [];\n\tprivate readonly _ignore = new Set<string>();\n\n\tconstructor(private readonly _view: vscode.TreeView<T>, private readonly _delegate: SymbolItemEditorHighlights<T>) {\n\t\tthis.disposables.push(\n\t\t\tvscode.workspace.onDidChangeTextDocument(e => this._ignore.add(e.document.uri.toString())),\n\t\t\tvscode.window.onDidChangeActiveTextEditor(() => _view.visible && this.update()),\n\t\t\t_view.onDidChangeVisibility(e => e.visible ? this._show() : this._hide()),\n\t\t\t_view.onDidChangeSelection(() => _view.visible && this.update())\n\t\t);\n\t\tthis._show();\n\t}\n\n\tdispose() {\n\t\tvscode.Disposable.from(...this.disposables).dispose();\n\t\tfor (const editor of vscode.window.visibleTextEditors) {\n\t\t\teditor.setDecorations(this._decorationType, []);\n\t\t}\n\t}\n\n\tprivate _show(): void {\n\t\tconst { activeTextEditor: editor } = vscode.window;\n\t\tif (!editor || !editor.viewColumn) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._ignore.has(editor.document.uri.toString())) {\n\t\t\treturn;\n\t\t}\n\t\tconst [anchor] = this._view.selection;\n\t\tif (!anchor) {\n\t\t\treturn;\n\t\t}\n\t\tconst ranges = this._delegate.getEditorHighlights(anchor, editor.document.uri);\n\t\tif (ranges) {\n\t\t\teditor.setDecorations(this._decorationType, ranges);\n\t\t}\n\t}\n\n\tprivate _hide(): void {\n\t\tfor (const editor of vscode.window.visibleTextEditors) {\n\t\t\teditor.setDecorations(this._decorationType, []);\n\t\t}\n\t}\n\n\tupdate(): void {\n\t\tthis._hide();\n\t\tthis._show();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { SymbolItemNavigation } from './references-view';\nimport { ContextKey } from './utils';\n\nexport class Navigation {\n\n\tprivate readonly _disposables: vscode.Disposable[] = [];\n\tprivate readonly _ctxCanNavigate = new ContextKey<boolean>('references-view.canNavigate');\n\n\tprivate _delegate?: SymbolItemNavigation<unknown>;\n\n\tconstructor(private readonly _view: vscode.TreeView<unknown>) {\n\t\tthis._disposables.push(\n\t\t\tvscode.commands.registerCommand('references-view.next', () => this.next(true)),\n\t\t\tvscode.commands.registerCommand('references-view.prev', () => this.previous(false)),\n\t\t);\n\t}\n\n\tdispose(): void {\n\t\tvscode.Disposable.from(...this._disposables).dispose();\n\t}\n\n\tupdate(delegate: SymbolItemNavigation<unknown> | undefined) {\n\t\tthis._delegate = delegate;\n\t\tthis._ctxCanNavigate.set(Boolean(this._delegate));\n\t}\n\n\tprivate _anchor(): undefined | unknown {\n\t\tif (!this._delegate) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst [sel] = this._view.selection;\n\t\tif (sel) {\n\t\t\treturn sel;\n\t\t}\n\t\tif (!vscode.window.activeTextEditor) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._delegate.nearest(vscode.window.activeTextEditor.document.uri, vscode.window.activeTextEditor.selection.active);\n\t}\n\n\tprivate _open(loc: vscode.Location, preserveFocus: boolean) {\n\t\tvscode.commands.executeCommand('vscode.open', loc.uri, {\n\t\t\tselection: new vscode.Selection(loc.range.start, loc.range.start),\n\t\t\tpreserveFocus\n\t\t});\n\t}\n\n\tprevious(preserveFocus: boolean): void {\n\t\tif (!this._delegate) {\n\t\t\treturn;\n\t\t}\n\t\tconst item = this._anchor();\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\t\tconst newItem = this._delegate.previous(item);\n\t\tconst newLocation = this._delegate.location(newItem);\n\t\tif (newLocation) {\n\t\t\tthis._view.reveal(newItem, { select: true, focus: true });\n\t\t\tthis._open(newLocation, preserveFocus);\n\t\t}\n\t}\n\n\tnext(preserveFocus: boolean): void {\n\t\tif (!this._delegate) {\n\t\t\treturn;\n\t\t}\n\t\tconst item = this._anchor();\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\t\tconst newItem = this._delegate.next(item);\n\t\tconst newLocation = this._delegate.location(newItem);\n\t\tif (newLocation) {\n\t\t\tthis._view.reveal(newItem, { select: true, focus: true });\n\t\t\tthis._open(newLocation, preserveFocus);\n\t\t}\n\t}\n}\n"],"sourceRoot":""}